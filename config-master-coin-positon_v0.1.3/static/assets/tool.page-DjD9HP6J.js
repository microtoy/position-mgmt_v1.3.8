import{d as ue,a9 as we,r as V,b0 as Xe,g as me,h as xe,c as o,I as h,j as v,k as H,b8 as K,o as t,w as y,b as e,m as _,b7 as Z,a as i,q as T,t as D,i as se,F as R,e as te,T as fe,ar as Ke,b6 as pe,f as ie,b9 as he,ao as Te,bd as We,bb as Ue,bV as Ve,ba as Ge,aH as Qe,b1 as Ze,b3 as ea,b5 as aa,ap as la,bW as ta,bX as M,bY as sa,B as oa,bZ as ra,bc as ia}from"./index-D8Idp9N8.js";import{z as ee,A as Se,f as Ie,k as Ne,l as Le,v as Ae,w as na,x as da,b as je,Q as qe,c as ua,d as ca,e as pa,H as ma,g as fa,_ as ke,i as va,C as _a,U as ya,D as ga}from"./uploadConfigDialog.tmpl-BmcSJ1Mv.js";import{b as Ce,s as ve,a as Be}from"./index-CMgMmmgV.js";import{c as xa}from"./index-CPAdQnGy.js";import"./index-tAOks71Y.js";const ba={key:0,class:"px-8 py-6"},ha={key:0,class:"grid grid-cols-2 gap-x-4 gap-y-3"},ka={class:"flex flex-col gap-y-2"},wa={key:0,class:"flex flex-col gap-y-2"},Va={key:1,class:"space-y-3"},Sa={class:"space-y-3"},Ca={class:"flex flex-col gap-2"},$a={class:"text-sm font-bold flex items-center gap-1"},Da={class:"pi pi-question-circle cursor-pointer"},za={class:"space-y-2"},Oa={class:"flex-1 grid grid-cols-2 gap-2"},Fa={class:"flex flex-col gap-y-1"},Ta={class:"flex flex-col gap-y-1"},Ua={class:"flex items-center gap-2"},Ia={class:"flex flex-col gap-y-2"},Na={class:"space-y-4"},La={class:"space-y-3"},Aa={class:"flex items-center gap-2"},ja={for:"other-section-toggle",class:"cursor-pointer font-bold text-sm"},qa={class:"pi pi-question-circle cursor-pointer"},Ba={key:0,class:"space-y-3"},Ma={class:"flex flex-col gap-2"},Ya={class:"flex flex-col gap-3"},Ea={class:"flex-1 grid grid-cols-3 gap-2",name:"add_factor_sub_list"},Pa={class:"flex flex-col gap-y-1"},Ra={class:"text-xs text-gray-600 dark:text-gray-400"},Ja={class:"flex flex-col gap-y-1"},Ha={class:"flex flex-col gap-y-1"},Xa={class:"text-xs text-gray-600 dark:text-gray-400 space-x-1 flex items-center"},Ka={class:"pi pi-question-circle cursor-pointer text-sm"},Wa={class:"flex items-center gap-2"},Ga={class:"flex mt-4"},Qa={class:"flex flex-col gap-y-2"},Za={class:"grid grid-cols-2 gap-x-4 gap-y-3"},el={class:"flex flex-col gap-y-2"},al={class:"flex flex-col gap-y-2"},ll={class:"flex w-full gap-2"},tl={class:"space-y-3"},sl={class:"flex flex-col gap-2"},ol={class:"space-y-2"},rl={class:"flex-1 grid grid-cols-2 gap-2",name:"add_factor_sub_list"},il={class:"flex flex-col gap-y-1"},nl={class:"text-xs text-gray-600 dark:text-gray-400"},dl={class:"flex flex-col gap-y-1"},ul={class:"flex items-center gap-2"},cl={class:"flex"},pl={class:"flex flex-col gap-y-2"},ml={key:0,class:"text-red-500 text-sm mb-2"},fl={class:"flex"},vl={class:"flex flex-col gap-y-4"},_l={class:"w-full border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden"},yl={key:0,class:"text-center py-4"},gl={key:1,class:"flex flex-col gap-y-3"},xl={class:"flex flex-col gap-y-2"},bl={key:2,class:"grid grid-cols-2 gap-4"},hl={class:"flex flex-col gap-y-2"},kl={class:"flex flex-col gap-y-2"},wl={class:"flex flex-col gap-y-2"},Vl={key:0},Sl={class:"flex gap-2"},Cl={class:"text-sm flex items-center gap-1"},$l={class:"font-bold"},Dl={class:"flex"},zl=ue({__name:"toolInputForm.tmpl",props:{toolName:{},runIsLoading:{type:Boolean}},setup(ae){const X=we(),S=V("plain"),C=V([]),l=V({main_factor:"",sub_factor:"",factor_dict:[],filter_list:[],mode:"",strategy_info:{strategy_name:0,start_time:void 0,end_time:void 0,add_factor_main_list:[{因子名称:"指数",次坐标轴:!0}],add_factor_sub_list:[]},param_search_info:{param_x:"",param_y:"",evaluation_indicator:"",limit_dict:{}},strategy_results:[]}),x=V(!1),f=V(),L=["K线图","柱状图","折线图"],$=V([]),N=V({add_factor_main_list:"",add_factor_sub_list:""}),g=V(Xe()),w=V([]),A=V(),B=V(!1),n=V([]),j=V([]),c=V({factor_dict:"",filter_list:""}),G=[{label:"只用现货",value:"spot"},{label:"只用合约",value:"swap"},{label:"现货和合约都用",value:"spot+swap"}],le=ae,ne=V({}),Q=me({get:()=>l.value.strategy_info.start_time?ee(l.value.strategy_info.start_time).toDate():void 0,set:s=>{l.value.strategy_info.start_time=s?ee(s).format("YYYY-MM-DD"):void 0}}),oe=me({get:()=>l.value.strategy_info.end_time?ee(l.value.strategy_info.end_time).toDate():void 0,set:s=>{l.value.strategy_info.end_time=s?ee(s).format("YYYY-MM-DD"):void 0}}),d=()=>{const s=We(g.value,l.value);l.value.param_search_info.limit_dict||(l.value.param_search_info.limit_dict={}),s&&typeof s=="object"&&Object.keys(s).forEach(a=>{Object.hasOwn(l.value.param_search_info.limit_dict,a)&&(Array.isArray(l.value.param_search_info.limit_dict[a])?s[a]=l.value.param_search_info.limit_dict[a][0]:s[a]=l.value.param_search_info.limit_dict[a])}),l.value.param_search_info.limit_dict=JSON.parse(JSON.stringify(s))},u=async s=>{var k;const a=await Ve(s);if(a.result===!0){const b={main_factor:"",sub_factor:"",factor_dict:[],filter_list:[],mode:"",strategy_info:{strategy_name:0,start_time:"",end_time:"",add_factor_main_list:[{因子名称:"指数",次坐标轴:!0}],add_factor_sub_list:[]},param_search_info:{param_x:"",param_y:"",limit_dict:{},evaluation_indicator:""},strategy_results:[]},U=JSON.parse(JSON.stringify(a.data||{}));l.value={...b,...U,param_search_info:{...b.param_search_info,...U.param_search_info||{},limit_dict:((k=U.param_search_info)==null?void 0:k.limit_dict)||{}}},s===pe.tool1&&(l.value.param_search_info&&l.value.param_search_info.param_x&&l.value.param_search_info.param_y?S.value="heatmap":S.value="plain",A.value=Ge(g.value),d())}};xe(()=>le.toolName,async s=>{if(N.value={add_factor_main_list:"",add_factor_sub_list:""},c.value={factor_dict:"",filter_list:""},$.value=[],s===pe.tool1){let a=aa;const k=await Qe("config");if(k.result===!0&&k.data){g.value=JSON.parse(JSON.stringify(k.data));let b=k.data.strategy_info;b=(b==null?void 0:b.strategy_config)||{};let U=JSON.parse(JSON.stringify(k.data));Object.keys(U).map(I=>{I.includes("[")&&U[I]!==null?$.value.push({label:Ze(ea(I),b,!1),value:I}):!["name","search_name","strategy_info"].includes(I)&&U[I]!==null&&$.value.push({label:a[I]||I,value:I})})}}u(s),f.value=[],w.value=[],ne.value={}},{immediate:!0}),xe(()=>S.value,s=>{s==="plain"&&(l.value.param_search_info.param_y=""),d()});const m=async({values:s})=>{var k;const a={};if(c.value={factor_dict:"",filter_list:""},l.value.filter_list&&l.value.filter_list.length>0)for(const b of l.value.filter_list){if(!b[0]){c.value.filter_list="添加的因子名称不能为空";break}const U=/^(pct|rank|val):([<>]=?|==|!=|<=|>=)\s*(.+)$/;if(!((k=b[2])!=null&&k.match(U))){c.value.filter_list="因子使用条件不正确，需要以 pct:, rank:, val: 开头，中间是判断运算符的字符串";break}}return{values:s,errors:a}},F=s=>{s===!1&&(l.value.filter_list=[])},z=async({values:s})=>{var U;const a={};(l.value.strategy_info.strategy_name===""||l.value.strategy_info.strategy_name===null)&&(a.strategy_name=[{message:"策略名称不能为空"}]),l.value.strategy_info.start_time||(a.start_time=[{message:"分析开始时间不能为空"}]),l.value.strategy_info.end_time||(a.end_time=[{message:"分析结束时间不能为空"}]),N.value={add_factor_main_list:"",add_factor_sub_list:""};const k=l.value.strategy_info.add_factor_sub_list.map(I=>{var de;return((de=I.因子名称)==null?void 0:de[0])||""});if(k.filter((I,de)=>k.indexOf(I)!==de).length>0&&(N.value.add_factor_sub_list="因子名称不能重复"),l.value.strategy_info.add_factor_sub_list.length>0)for(const I of l.value.strategy_info.add_factor_sub_list){if(I.因子名称&&((U=I.因子名称)==null?void 0:U[0])===""){N.value.add_factor_sub_list="添加的因子名称不能为空";break}if(I.图形样式===""){N.value.add_factor_sub_list="添加的因子图形样式不能为空";break}}return{values:s,errors:a}},P=async({values:s})=>{const a={};l.value.param_search_info.param_x||(a.param_x=[{message:"分析参数是必选项"}]),l.value.param_search_info.evaluation_indicator||(a.evaluation_indicator=[{message:"分析指标是必选项"}]),S.value==="heatmap"?(l.value.param_search_info.param_y||(a.param_y=[{message:"Y轴参数是必选项"}]),l.value.param_search_info.param_x&&l.value.param_search_info.param_y&&l.value.param_search_info.param_x===l.value.param_search_info.param_y&&(a.param_x=[{message:"X轴和Y轴参数不能相同"}],a.param_y=[{message:"X轴和Y轴参数不能相同"}])):l.value.param_search_info.param_y="";const k=l.value.param_search_info.limit_dict;return k&&Object.entries(k).forEach(([b,U])=>{var I;U||(a[`${b}`]=[{message:`请为${he(b,(I=g.value.strategy_info)==null?void 0:I.strategy_config)}选择一个固定值`}])}),{values:s,errors:a}},q=async({values:s})=>{const a={};return(!l.value.strategy_results||l.value.strategy_results.length===0)&&(a.strategy_results=[{message:"回测策略名称至少选择一个"}]),{values:s,errors:a}},E=async({valid:s})=>{if(s){x.value=!0;const a=await Ue(le.toolName,l.value);x.value=!1,a.result===!0&&(X.add({severity:"success",summary:"保存成功！",life:3e3}),u(le.toolName))}},ce=(s,a)=>{var k;l.value.filter_list&&l.value.filter_list.length>0&&(l.value.filter_list[a][1]=((k=n.value.find(b=>b[0]===s))==null?void 0:k[1])||null)},_e=V(""),Ye=s=>ne.value[s]||[],Ee=(s,a)=>{l.value.factor_dict[a].params=[]};return(s,a)=>{const k=Ne,b=Ce,U=ve,I=Le,de=Ae,$e=je,ye=Ie,De=qe,ze=pa,Pe=ca,Re=ua,Je=Be,He=Se,be=fe;return v(H)==="coin"&&v(K).tool3===s.toolName?(t(),o("div",ba," 功能开发中，敬请期待！ ")):(t(),h(He,{key:1,class:"mx-5 my-5 border-1 border-gray-100 dark:border-neutral-700",pt:{body:{class:"pt-0"}}},{content:y(()=>[a[49]||(a[49]=e("div",{class:"font-semibold py-3"},"配置参数",-1)),a[50]||(a[50]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"配置参数保存成功后方可运行并获取分析结果",-1)),s.toolName===v(Z).tool1||s.toolName===v(Z).tool2||s.toolName===v(K).tool1?(t(),h(ye,{key:0,resolver:m,onSubmit:E,class:"flex-1 flex flex-col space-y-4 mt-3"},{default:y(O=>{var W,J,re;return[s.toolName===v(Z).tool1||s.toolName===v(Z).tool2?(t(),o("div",ha,[e("div",ka,[a[16]||(a[16]=e("label",{class:"text-sm flex items-center gap-1"},[e("span",{class:"text-red-500"},"*"),e("span",{class:"font-bold"},"因子1")],-1)),i(k,{size:"small",name:"main_factor",modelValue:l.value.main_factor,"onUpdate:modelValue":a[0]||(a[0]=r=>l.value.main_factor=r),options:C.value,placeholder:"请选择因子",checkmark:"",highlightOnSelect:!1,class:"w-full",showClear:""},null,8,["modelValue","options"]),(W=O.main_factor)!=null&&W.invalid?(t(),h(b,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>{var r;return[T(D((r=O.main_factor.error)==null?void 0:r.message),1)]}),_:2},1024)):_("",!0)]),s.toolName==="tool2_双因子分析"?(t(),o("div",wa,[a[17]||(a[17]=e("label",{class:"text-sm flex items-center gap-1"},[e("span",{class:"text-red-500"},"*"),e("span",{class:"font-bold"},"因子2")],-1)),i(k,{size:"small",name:"sub_factor",modelValue:l.value.sub_factor,"onUpdate:modelValue":a[1]||(a[1]=r=>l.value.sub_factor=r),options:C.value.filter(r=>r!==l.value.main_factor),placeholder:"请选择因子",checkmark:"",highlightOnSelect:!1,class:"w-full",showClear:""},null,8,["modelValue","options"]),(J=O.sub_factor)!=null&&J.invalid?(t(),h(b,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>{var r;return[T(D((r=O.sub_factor.error)==null?void 0:r.message),1)]}),_:2},1024)):_("",!0)])):_("",!0)])):(t(),o("div",Va,[e("div",Sa,[e("div",Ca,[e("label",$a,[a[18]||(a[18]=e("span",{class:"text-red-500"},"*",-1)),a[19]||(a[19]=e("span",null,"策略因子配置",-1)),se(e("i",Da,null,512),[[be,{value:"1.选择策略因子及每个因子对应的参数，支持单参数和多参数<br/>2.原始分箱图分组排序默认从小到大，即第一组为因子值最小的一组，最后一组为因子值最大的一组",autoHide:!1,escape:!1,class:"min-w-88"},void 0,{bottom:!0}]])]),i(U,{size:"small",variant:"outlined",icon:"pi pi-plus",label:"添加策略因子配置",onClick:a[2]||(a[2]=()=>{l.value.factor_dict||(l.value.factor_dict=[]),l.value.factor_dict.push({factor:"",params:[]})})})]),e("div",za,[(t(!0),o(R,null,te(l.value.factor_dict,(r,p)=>(t(),o("div",{key:p,class:"flex items-center gap-2 p-3 bg-white dark:bg-neutral-700/50 rounded-md border-1 border-gray-300/50 dark:border-0"},[e("div",Oa,[e("div",Fa,[a[20]||(a[20]=e("label",{class:"text-xs text-gray-600 dark:text-gray-400"},"选择因子",-1)),i(k,{modelValue:r.factor,"onUpdate:modelValue":Y=>r.factor=Y,options:Object.keys(ne.value),placeholder:"选择因子",class:"w-full",onValueChange:Y=>Ee(Y,p)},null,8,["modelValue","onUpdate:modelValue","options","onValueChange"])]),e("div",Ta,[a[21]||(a[21]=e("label",{class:"text-xs text-gray-600 dark:text-gray-400"},"因子参数(多选)",-1)),e("div",Ua,[i(I,{modelValue:r.params,"onUpdate:modelValue":Y=>r.params=Y,size:"small",options:Ye(r.factor),placeholder:"选择参数",class:"w-full",display:"chip"},null,8,["modelValue","onUpdate:modelValue","options"]),i(U,{size:"small",variant:"text",icon:"pi pi-trash",severity:"danger",onClick:()=>{l.value.factor_dict&&l.value.factor_dict.splice(p,1)}},null,8,["onClick"])])])])]))),128)),c.value.factor_dict?(t(),h(b,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>[T(D(c.value.factor_dict),1)]),_:1})):_("",!0)])]),e("div",Ia,[a[22]||(a[22]=e("label",{class:"text-sm flex items-center gap-1"},[e("span",{class:"text-red-500"},"*"),e("span",{class:"font-bold"},"数据模式")],-1)),i(k,{size:"small",name:"mode",modelValue:l.value.mode,"onUpdate:modelValue":a[3]||(a[3]=r=>l.value.mode=r),options:G,optionLabel:"label",optionValue:"value",placeholder:"请选择数据模式",checkmark:"",highlightOnSelect:!1,class:"w-full",showClear:""},null,8,["modelValue"]),(re=O.mode)!=null&&re.invalid?(t(),h(b,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>{var r;return[T(D((r=O.mode.error)==null?void 0:r.message),1)]}),_:2},1024)):_("",!0)]),_e.value?(t(),h(b,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>[T(D(_e.value),1)]),_:1})):_("",!0)])),e("div",Na,[e("div",La,[e("div",Aa,[i(de,{modelValue:B.value,"onUpdate:modelValue":a[4]||(a[4]=r=>B.value=r),inputId:"other-section-toggle","aria-label":"分域配置启用开关",onValueChange:F},null,8,["modelValue"]),e("label",ja,D(B.value?"已启用分域配置":"未启用分域配置"),1),se(e("i",qa,null,512),[[be,{value:`${v(Ke)?v(na):v(da)}`,autoHide:!1,escape:!1,class:"min-w-150"}]])]),i(b,{icon:"pi pi-exclamation-triangle",size:"small",severity:"warn"},{default:y(()=>a[23]||(a[23]=[T(" 使用该功能前，请确保在策略管理页面的当前配置中设置分域因子并完成回测，否则因子下拉列表为空，功能不可用。 ")])),_:1,__:[23]})]),B.value?(t(),o("div",Ba,[e("div",Ma,[a[24]||(a[24]=e("label",{class:"text-sm font-bold flex items-center gap-1"},[e("span",null,"分域配置")],-1)),i(U,{size:"small",variant:"outlined",icon:"pi pi-plus",label:"添加分域",onClick:a[5]||(a[5]=()=>{l.value.filter_list||(l.value.filter_list=[]),l.value.filter_list.push(["",null,""])})})]),e("div",Ya,[a[27]||(a[27]=e("span",{class:"text-xs text-gray-600 flex items-center gap-1"},[e("i",{class:"pi pi-info-circle text-xs"}),T(" 因子使用条件需要以 pct: 或 rank: 或 val: 开头，中间是判断运算符的字符串，最后是数值，例如rank:>1")],-1)),(t(!0),o(R,null,te(l.value.filter_list,(r,p)=>(t(),o("div",{key:p,class:"flex items-center gap-2 p-3 bg-white dark:bg-neutral-700/50 rounded-md border-1 border-gray-300/50 dark:border-0"},[e("div",Ea,[e("div",Pa,[e("label",Ra,"因子"+D(p+1),1),i(k,{size:"small",modelValue:r[0],"onUpdate:modelValue":Y=>r[0]=Y,options:j.value,placeholder:"选择因子",class:"w-full",onValueChange:Y=>ce(Y,p)},null,8,["modelValue","onUpdate:modelValue","options","onValueChange"])]),e("div",Ja,[a[25]||(a[25]=e("label",{class:"text-xs text-gray-600 dark:text-gray-400"},"因子参数",-1)),i($e,{modelValue:r[1],size:"small",disabled:""},null,8,["modelValue"])]),e("div",Ha,[e("label",Xa,[a[26]||(a[26]=e("span",null,"因子使用条件",-1)),se(e("i",Ka,null,512),[[be,{value:`${v(H)==="coin"?"因子使用条件有三种：pct， rank， val，用于过滤因子的排序。pct按照百分比排序，rank按照排名排序，val按照因子值排序。具体用法请参考：<a href='https://bbs.quantclass.cn/thread/51348' target='_blank' class='text-primary-500 hover:underline'>【25分享会小白攻略】B圈选币回测框架V1.8.X使用指南 - 量化小论坛</a> 第五章第二节策略配置中过滤因子的使用方法。":"因子使用条件有三种：pct， rank， val，用于过滤因子的排序。pct按照百分比排序，rank按照排名排序，val按照因子值排序。具体用法请参考：<a href='https://bbs.quantclass.cn/thread/64759' target='_blank' class='text-primary-500 hover:underline'>【25分享会小白攻略】大A选股回测框架V1.5.X使用指南 - 量化小论坛</a> 第三章第三步策略设置的filerlist说明。"}`,autoHide:!1,escape:!1,class:"min-w-85"},void 0,{bottom:!0}]])]),e("div",Wa,[i($e,{modelValue:r[2],"onUpdate:modelValue":Y=>r[2]=Y,type:"text",placeholder:"例如：rank:>1",size:"small",fluid:"",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"]),i(U,{size:"small",variant:"text",icon:"pi pi-trash",severity:"danger",onClick:()=>{l.value.filter_list&&l.value.filter_list.splice(p,1)}},null,8,["onClick"])])])])]))),128))])])):_("",!0),c.value.filter_list?(t(),h(b,{key:1,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>[T(D(c.value.filter_list),1)]),_:1})):_("",!0)]),e("div",Ga,[i(U,{type:"submit",size:"small",variant:"outlined",disabled:s.runIsLoading,loading:x.value},{default:y(()=>a[28]||(a[28]=[T("保存")])),_:1,__:[28]},8,["disabled","loading"])])]}),_:1})):_("",!0),v(H)==="stock"?(t(),o(R,{key:1},[s.toolName===v(Z).tool3?(t(),h(ye,{key:0,resolver:z,onSubmit:E,class:"flex-1 flex flex-col space-y-3 mt-3"},{default:y(O=>{var W,J,re;return[e("div",Qa,[a[29]||(a[29]=e("label",{class:"text-sm flex items-center gap-1"},[e("span",{class:"text-red-500"},"*"),e("span",{class:"font-bold"},"策略名称")],-1)),i(k,{size:"small",name:"strategy_name",modelValue:l.value.strategy_info.strategy_name,"onUpdate:modelValue":a[6]||(a[6]=r=>l.value.strategy_info.strategy_name=r),options:f.value,optionLabel:"label",optionValue:"value",placeholder:"请选择策略",checkmark:"",highlightOnSelect:!1,class:"w-full",showClear:""},null,8,["modelValue","options"]),(W=O.strategy_name)!=null&&W.invalid?(t(),h(b,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>{var r;return[T(D((r=O.strategy_name.error)==null?void 0:r.message),1)]}),_:2},1024)):_("",!0)]),e("div",Za,[e("div",el,[a[30]||(a[30]=e("label",{class:"text-sm space-x-1"},[e("span",{class:"text-red-500"},"*"),e("span",{class:"font-bold"},"分析开始时间"),e("span",{class:"text-xs text-gray-500 dark:text-gray-300"})],-1)),i(De,{id:"start_time",name:"start_time",modelValue:Q.value,"onUpdate:modelValue":a[7]||(a[7]=r=>Q.value=r),dateFormat:"yy-mm-dd",size:"small",placeholder:"请选择分析开始时间（要小于分析结束时间）",maxDate:oe.value?v(ee)(oe.value).subtract(1,"day").toDate():void 0},null,8,["modelValue","maxDate"]),a[31]||(a[31]=e("span",{class:"text-xs text-gray-500 dark:text-gray-300 ml-1"}," 提示：请确保分析开始时间 ≥ 回测的开始时间，否则会导致回测之前的分析数据缺失 ",-1)),(J=O.start_time)!=null&&J.invalid?(t(),h(b,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>{var r;return[T(D((r=O.start_time.error)==null?void 0:r.message),1)]}),_:2},1024)):_("",!0)]),e("div",al,[a[32]||(a[32]=e("label",{class:"text-sm space-x-1"},[e("span",{class:"text-red-500"},"*"),e("span",{class:"font-bold"},"分析结束时间"),e("span",{class:"text-xs text-gray-500 dark:text-gray-300"})],-1)),e("div",ll,[i(De,{id:"end_time",name:"end_time",modelValue:oe.value,"onUpdate:modelValue":a[8]||(a[8]=r=>oe.value=r),dateFormat:"yy-mm-dd",size:"small",placeholder:"请选择分析结束时间（要大于分析开始时间）",minDate:Q.value?v(ee)(Q.value).add(1,"day").toDate():void 0,class:"flex-1"},null,8,["modelValue","minDate"])]),a[33]||(a[33]=e("span",{class:"text-xs text-gray-500 dark:text-gray-300 ml-1"}," 提示：请确保分析结束时间 ≤ 跑回测的结束时间，否则会导致回测之后的分析数据缺失 ",-1)),(re=O.end_time)!=null&&re.invalid?(t(),h(b,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>{var r;return[T(D((r=O.end_time.error)==null?void 0:r.message),1)]}),_:2},1024)):_("",!0)])]),e("div",null,[e("div",tl,[e("div",sl,[a[34]||(a[34]=e("label",{class:"text-sm font-bold flex items-center gap-1"},[e("span",null,"因子配置")],-1)),i(U,{size:"small",variant:"outlined",icon:"pi pi-plus",label:"添加因子",onClick:a[9]||(a[9]=()=>{l.value.strategy_info.add_factor_sub_list.push({因子名称:[""],图形样式:""})})})]),e("div",ol,[(t(!0),o(R,null,te(l.value.strategy_info.add_factor_sub_list,(r,p)=>(t(),o("div",{key:p,class:"flex items-center gap-2 p-3 bg-white dark:bg-neutral-700/50 rounded-md border-1 border-gray-300/50 dark:border-0"},[e("div",rl,[e("div",il,[e("label",nl,"因子"+D(p+1),1),i(k,{size:"small",modelValue:r.因子名称[0],"onUpdate:modelValue":Y=>r.因子名称[0]=Y,options:C.value,placeholder:"选择因子",class:"w-full"},null,8,["modelValue","onUpdate:modelValue","options"])]),e("div",dl,[a[35]||(a[35]=e("label",{class:"text-xs text-gray-600 dark:text-gray-400"},"图形样式",-1)),e("div",ul,[i(k,{size:"small",modelValue:r.图形样式,"onUpdate:modelValue":Y=>r.图形样式=Y,options:L,placeholder:"选择图形样式",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"]),i(U,{size:"small",variant:"text",icon:"pi pi-trash",severity:"danger",onClick:()=>{l.value.strategy_info.add_factor_sub_list.splice(p,1)}},null,8,["onClick"])])])])]))),128)),N.value.add_factor_sub_list?(t(),h(b,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>[T(D(N.value.add_factor_sub_list),1)]),_:1})):_("",!0)])])]),e("div",cl,[i(U,{type:"submit",size:"small",variant:"outlined",disabled:s.runIsLoading,loading:x.value},{default:y(()=>a[36]||(a[36]=[T("保存")])),_:1,__:[36]},8,["disabled","loading"])])]}),_:1})):_("",!0)],64)):v(H)==="coin"?(t(),o(R,{key:2},[s.toolName===v(K).tool4||s.toolName===v(K).tool5?(t(),h(ye,{key:0,resolver:q,onSubmit:E,class:"flex-1 flex flex-col space-y-4 mt-3"},{default:y(O=>{var W;return[e("div",pl,[w.value.length===0?(t(),o("div",ml," 当前暂无回测结果，请先在 PyCharm 启动回测，或前往策略管理页面执行「一键回测」 ")):_("",!0),a[37]||(a[37]=e("label",{class:"text-sm flex items-center gap-1"},[e("span",{class:"text-red-500"},"*"),e("span",{class:"font-bold"},"回测策略名称(多选)")],-1)),i(I,{size:"small",name:"strategy_results",modelValue:l.value.strategy_results,"onUpdate:modelValue":a[10]||(a[10]=J=>l.value.strategy_results=J),options:w.value,filter:"",placeholder:"请选择回测策略名称（可多选）",maxSelectedLabels:4,selectedItemsLabel:"{0} 个策略已选择",class:"w-full",display:"chip"},null,8,["modelValue","options"]),(W=O.strategy_results)!=null&&W.invalid?(t(),h(b,{key:1,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>{var J;return[T(D((J=O.strategy_results.error)==null?void 0:J.message),1)]}),_:2},1024)):_("",!0)]),e("div",fl,[i(U,{type:"submit",size:"small",variant:"outlined",disabled:s.runIsLoading,loading:x.value},{default:y(()=>a[38]||(a[38]=[T("保存")])),_:1,__:[38]},8,["disabled","loading"])])]}),_:1})):_("",!0)],64)):_("",!0),v(H)==="stock"&&s.toolName===v(Z).tool4||v(H)==="coin"&&s.toolName===v(K).tool2||v(H)==="positionCoin"&&s.toolName===v(pe).tool1?(t(),h(ye,{key:3,resolver:P,onSubmit:E,class:"flex-1 flex flex-col space-y-3 mt-3"},{default:y(O=>{var W,J,re,r;return[e("div",vl,[e("div",_l,[i(Re,{value:S.value,"onUpdate:value":a[11]||(a[11]=p=>S.value=p),class:"w-full"},{default:y(()=>[i(Pe,{class:"flex bg-gray-50 dark:bg-neutral-800"},{default:y(()=>[i(ze,{value:"plain",class:ie(["flex-1 relative",["transition-colors duration-200 py-3 text-sm font-medium",S.value==="plain"?"text-primary-600 dark:text-primary-400":"text-gray-600 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400"]]),pt:{root:"focus:outline-none focus:ring-0"}},{default:y(()=>[a[39]||(a[39]=e("span",{class:"flex items-center justify-center gap-2"}," 单参数平原图 ",-1)),e("div",{class:ie(["absolute bottom-0 left-0 w-full h-0.5 transition-transform duration-200",["bg-primary-600 dark:bg-primary-400",S.value==="plain"?"scale-x-100":"scale-x-0"]])},null,2)]),_:1,__:[39]},8,["class"]),i(ze,{value:"heatmap",class:ie(["flex-1 relative",["transition-colors duration-200 py-3 text-sm font-medium",S.value==="heatmap"?"text-primary-600 dark:text-primary-400":"text-gray-600 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400",$.value.length<=1?"opacity-50 cursor-not-allowed":""]]),disabled:$.value.length<=1,pt:{root:"focus:outline-none focus:ring-0"}},{default:y(()=>[a[40]||(a[40]=e("span",{class:"flex items-center justify-center gap-2"}," 双参数热力图 ",-1)),e("div",{class:ie(["absolute bottom-0 left-0 w-full h-0.5 transition-transform duration-200",["bg-primary-600 dark:bg-primary-400",S.value==="heatmap"?"scale-x-100":"scale-x-0"]])},null,2)]),_:1,__:[40]},8,["class","disabled"])]),_:1})]),_:1},8,["value"])]),$.value.length===0?(t(),o("div",yl,a[41]||(a[41]=[e("div",{class:"text-red-500 text-sm mb-2"}," 未启用遍历配置，或已启用的遍历配置未配置参数 ",-1),e("div",{class:"text-gray-500 text-xs"},"请先在遍历配置中设置参数",-1)]))):S.value==="plain"?(t(),o("div",gl,[e("div",xl,[a[42]||(a[42]=e("label",{class:"text-sm flex items-center gap-1"},[e("span",{class:"text-red-500"},"*"),e("span",{class:"font-bold"},"分析参数")],-1)),i(k,{size:"small",name:"param_x",modelValue:l.value.param_search_info.param_x,"onUpdate:modelValue":a[12]||(a[12]=p=>l.value.param_search_info.param_x=p),options:$.value,optionLabel:"label",optionValue:"value",placeholder:"请选择要分析的参数",class:"w-full",showClear:!0,onValueChange:d},null,8,["modelValue","options"]),(W=O.param_x)!=null&&W.invalid?(t(),h(b,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>{var p;return[T(D((p=O.param_x.error)==null?void 0:p.message),1)]}),_:2},1024)):_("",!0)])])):S.value==="heatmap"?(t(),o("div",bl,[e("div",hl,[a[43]||(a[43]=e("label",{class:"text-sm flex items-center gap-1"},[e("span",{class:"text-red-500"},"*"),e("span",{class:"font-bold"},"X轴参数")],-1)),i(k,{size:"small",name:"param_x",modelValue:l.value.param_search_info.param_x,"onUpdate:modelValue":a[13]||(a[13]=p=>l.value.param_search_info.param_x=p),options:$.value,optionLabel:"label",optionValue:"value",placeholder:"请选择X轴参数",class:"w-full",showClear:!0,onValueChange:d},null,8,["modelValue","options"]),(J=O.param_x)!=null&&J.invalid?(t(),h(b,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>{var p;return[T(D((p=O.param_x.error)==null?void 0:p.message),1)]}),_:2},1024)):_("",!0)]),e("div",kl,[a[44]||(a[44]=e("label",{class:"text-sm flex items-center gap-1"},[e("span",{class:"text-red-500"},"*"),e("span",{class:"font-bold"},"Y轴参数")],-1)),i(k,{size:"small",name:"param_y",modelValue:l.value.param_search_info.param_y,"onUpdate:modelValue":a[14]||(a[14]=p=>l.value.param_search_info.param_y=p),options:$.value.filter(p=>p.value!==l.value.param_search_info.param_x),optionLabel:"label",optionValue:"value",placeholder:"请选择Y轴参数",class:"w-full",showClear:!0,onValueChange:d},null,8,["modelValue","options"]),(re=O.param_y)!=null&&re.invalid?(t(),h(b,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>{var p;return[T(D((p=O.param_y.error)==null?void 0:p.message),1)]}),_:2},1024)):_("",!0)])])):_("",!0)]),$.value.length>0?(t(),o(R,{key:0},[e("div",wl,[a[45]||(a[45]=e("label",{class:"text-sm flex items-center gap-1"},[e("span",{class:"text-red-500"},"*"),e("span",{class:"font-bold"},"分析指标")],-1)),i(k,{size:"small",name:"evaluation_indicator",modelValue:l.value.param_search_info.evaluation_indicator,"onUpdate:modelValue":a[15]||(a[15]=p=>l.value.param_search_info.evaluation_indicator=p),options:v(ma),placeholder:"请选择分析指标",checkmark:"",filter:"",highlightOnSelect:!1,class:"w-full",showClear:""},null,8,["modelValue","options"]),(r=O.evaluation_indicator)!=null&&r.invalid?(t(),h(b,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>{var p;return[T(D((p=O.evaluation_indicator.error)==null?void 0:p.message),1)]}),_:2},1024)):_("",!0)]),l.value.param_search_info.limit_dict&&Object.keys(l.value.param_search_info.limit_dict).length>0?(t(),o("div",Vl,[i(Je),a[47]||(a[47]=e("div",{class:"flex items-center gap-2 mb-3"},[e("span",{class:"font-semibold text-gray-700 dark:text-gray-300"},"固定参数设置"),e("span",{class:"text-xs text-gray-500"},"(请为其他参数选择固定值)")],-1)),e("div",Sl,[(t(!0),o(R,null,te(Object.keys(l.value.param_search_info.limit_dict),p=>{var Y,Oe,Fe;return t(),o("div",{class:"flex flex-col gap-y-2 w-full",key:p},[e("label",Cl,[a[46]||(a[46]=e("span",{class:"text-red-500"},"*",-1)),e("span",$l,D(v(he)(p,v(Te)?(Y=g.value.strategy_info)==null?void 0:Y.strategy_config:g.value.strategy_info)),1)]),i(k,{size:"small",name:p,modelValue:l.value.param_search_info.limit_dict[p],"onUpdate:modelValue":ge=>l.value.param_search_info.limit_dict[p]=ge,options:A.value[p],placeholder:`请选择${v(he)(p,v(Te)?(Oe=g.value.strategy_info)==null?void 0:Oe.strategy_config:g.value.strategy_info)}的固定值`,class:"w-full",showClear:!0},null,8,["name","modelValue","onUpdate:modelValue","options","placeholder"]),(Fe=O[p])!=null&&Fe.invalid?(t(),h(b,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>{var ge;return[T(D((ge=O[p].error)==null?void 0:ge.message),1)]}),_:2},1024)):_("",!0)])}),128))])])):_("",!0),e("div",Dl,[i(U,{type:"submit",size:"small",variant:"outlined",disabled:s.runIsLoading,loading:x.value},{default:y(()=>a[48]||(a[48]=[T("保存")])),_:1,__:[48]},8,["disabled","loading"])])],64)):_("",!0)]}),_:1})):_("",!0)]),_:1}))}}}),Ol={key:0,class:"flex-1 px-5 py-2 flex flex-col gap-y-6"},Fl={key:0,class:"flex-1 flex flex-col items-center justify-center gap-2"},Tl={key:1,class:"flex-1"},Ul={key:0,class:"h-full space-y-4"},Il={class:"space-y-3"},Nl={key:0},Ll={class:"text-sm text-gray-600 dark:text-gray-400"},Al=["src"],jl={key:1,class:"h-full flex flex-col items-center justify-center gap-4 py-4"},ql=ue({__name:"toolOutput.tmpl",props:{toolName:{}},setup(ae,{expose:X}){const S=ae,C=V(!1),l=V([]),x=V({}),f=async g=>{if(!g)return;C.value=!0;const w=await ta(g);C.value=!1,w.result===!0&&(w.data?(l.value=w.data,x.value={}):(l.value=[],x.value={}))};xe(()=>S.toolName,g=>{g&&f(g)},{immediate:!0});const L=g=>{x.value[g]=!x.value[g]},$=g=>{g&&window.open(g,"_blank")},N=g=>{if(!g)return"";const w=new Date().getTime(),A=g.includes("?")?"&":"?";return`${g}${A}_t=${w}`};return X({loadToolAnalysisInfo:f}),(g,w)=>{const A=xa,B=ve,n=fa,j=fe;return v(H)==="coin"&&v(K).tool3===g.toolName?_("",!0):(t(),o("div",Ol,[w[3]||(w[3]=e("div",{class:"font-semibold"},"分析结果",-1)),C.value?(t(),o("div",Fl,[i(A),w[0]||(w[0]=e("span",{class:"ml-2 text-gray-500 text-sm"},"加载中...",-1))])):(t(),o("div",Tl,[l.value.length>0?(t(),o("div",Ul,[(t(!0),o(R,null,te(l.value,(c,G)=>(t(),h(n,{key:c.name+G,header:c.name,toggleable:"",collapsed:x.value[G]===!0,onToggle:()=>L(G)},{icons:y(()=>[c.full_path?se((t(),h(B,{key:0,size:"small",variant:"text",icon:"pi pi-external-link",onClick:la(le=>$(N(c.html)),["stop"])},null,8,["onClick"])),[[j,"在新标签打开",void 0,{top:!0}]]):_("",!0)]),default:y(()=>[e("div",Il,[c.full_path?(t(),o("div",Nl,[w[1]||(w[1]=e("span",{class:"text-sm font-semibold"},"本地存储地址：",-1)),e("span",Ll,D(c.full_path),1)])):_("",!0),c.html?(t(),o("iframe",{key:1,src:N(c.html),width:"100%",frameborder:"0",title:"分析结果展示",class:"min-h-[600px]"},null,8,Al)):_("",!0)])]),_:2},1032,["header","collapsed","onToggle"]))),128))])):(t(),o("div",jl,w[2]||(w[2]=[e("img",{src:ke,class:"w-40 h-auto"},null,-1),e("span",{class:"text-gray-500 text-sm"},"暂无分析结果",-1)])))]))]))}}}),Bl={class:"font-medium text-sm flex items-center gap-1"},Ml={key:0,class:"text-red-500"},Yl={key:0,class:"text-xs text-gray-500 dark:text-gray-300"},El={key:1,class:"pi pi-question-circle cursor-pointer"},Pl={key:5,class:"flex items-center gap-2 h-[35px]"},Me=ue({__name:"formGrid.tmpl",props:{items:{},formData:{},formSchema:{},gridCol:{},isArrayObject:{type:Boolean}},emits:["updateField"],setup(ae,{emit:X}){const S=X,C=(l,x)=>{S("updateField",l,x)};return(l,x)=>{const f=je,L=va,$=Ne,N=Le,g=qe,w=Ae,A=Ce,B=fe;return t(),o("div",{class:ie(["grid grid-cols-2 gap-4",`grid-cols-${l.gridCol||2}`])},[(t(!0),o(R,null,te(l.items,n=>{var j;return t(),o("div",{key:n.field,class:"flex flex-col gap-1"},[e("label",Bl,[n.required?(t(),o("span",Ml,"*")):_("",!0),e("span",{class:ie([l.isArrayObject?"text-xs text-gray-600 dark:text-gray-400":"font-bold"])},[T(D(n.label)+" ",1),n.type===v(M).multiSelect?(t(),o("span",Yl," (多选) ")):_("",!0)],2),n.tips?se((t(),o("i",El,null,512)),[[B,{value:n.tips,autoHide:!1,escape:!1}]]):_("",!0)]),n.type===v(M).input?(t(),h(f,{key:0,"model-value":l.formData[n.field],"onUpdate:modelValue":c=>C(n.field,c),placeholder:`请输入${n.label}`,size:"small",name:n.field},null,8,["model-value","onUpdate:modelValue","placeholder","name"])):n.type===v(M).number?(t(),h(L,{key:1,"model-value":l.formData[n.field],"onUpdate:modelValue":c=>C(n.field,c),placeholder:`请输入${n.label}`,size:"small",showButtons:"",name:n.field},null,8,["model-value","onUpdate:modelValue","placeholder","name"])):n.type===v(M).select?(t(),h($,{key:2,"model-value":l.formData[n.field],"onUpdate:modelValue":c=>C(n.field,c),options:n.options||[],optionLabel:"label",optionValue:"value",placeholder:`请选择${n.label}`,size:"small",name:n.field},null,8,["model-value","onUpdate:modelValue","options","placeholder","name"])):n.type===v(M).multiSelect?(t(),h(N,{key:3,"model-value":l.formData[n.field],"onUpdate:modelValue":c=>C(n.field,c),options:n.options||[],optionLabel:"label",optionValue:"value",placeholder:`请选择${n.label}`,size:"small",name:n.field},null,8,["model-value","onUpdate:modelValue","options","placeholder","name"])):n.type===v(M).date?(t(),h(g,{key:4,"model-value":l.formData[n.field],"onUpdate:modelValue":c=>C(n.field,c),dateFormat:"yy-mm-dd",size:"small",placeholder:"请选择时间",showIcon:"",name:n.field},null,8,["model-value","onUpdate:modelValue","name"])):n.type===v(M).boolean?(t(),o("div",Pl,[i(w,{"model-value":l.formData[n.field],"onUpdate:modelValue":c=>C(n.field,c),name:n.field},null,8,["model-value","onUpdate:modelValue","name"]),e("span",null,D(l.formData[n.field]?"是":"否"),1)])):_("",!0),(j=l.formSchema.errors)!=null&&j[n.field]?(t(),h(A,{key:6,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>{var c;return[T(D((c=l.formSchema.errors[n.field][0])==null?void 0:c.message),1)]}),_:2},1024)):_("",!0)])}),128))],2)}}}),Rl={class:"mt-4 flex flex-col gap-1"},Jl={class:"font-medium text-sm flex items-center gap-1"},Hl={key:0,class:"text-red-500"},Xl={class:"font-bold"},Kl={key:1,class:"pi pi-question-circle cursor-pointer text-gray-400"},Wl={class:"flex flex-col gap-3 p-3 bg-white dark:bg-neutral-700/50 rounded-md border-1 border-gray-300/50 dark:border-0"},Gl={class:"flex items-start gap-3"},Ql={class:"flex-1"},Zl=ue({__name:"formArrayObject.tmpl",props:{item:{},formData:{},formSchema:{}},emits:["addItem","removeItem","updateArrayField"],setup(ae,{emit:X}){const S=ae,C=X,l=(f,L,$)=>{C("updateArrayField",S.item.field,f,L,$)},x=(f,L)=>{const $={};return S.formSchema.errors&&Object.keys(S.formSchema.errors).forEach(N=>{const g=N.match(new RegExp(`^${f}\\[${L}\\]\\.(.+)$`));if(g){const w=g[1],A=S.formSchema.errors[N];$[w]=Array.isArray(A)?A:[A]}}),{...S.formSchema,errors:$}};return(f,L)=>{var w;const $=ve,N=Ce,g=fe;return t(),o("div",Rl,[e("label",Jl,[f.item.required?(t(),o("span",Hl,"*")):_("",!0),e("span",Xl,D(f.item.label),1),f.item.tips?se((t(),o("i",Kl,null,512)),[[g,{value:f.item.tips,autoHide:!1,escape:!1}]]):_("",!0)]),e("div",Wl,[(t(!0),o(R,null,te(f.formData[f.item.field],(A,B)=>(t(),o("div",{key:B,class:ie(["pb-3 last:pb-0 last:border-0",{"border-b border-gray-200 dark:border-gray-600":B!==f.formData[f.item.field].length-1}])},[e("div",Gl,[e("div",Ql,[i(Me,{items:f.item.itemSchema||[],"form-data":f.formData[f.item.field][B],formSchema:x(f.item.field,B),gridCol:3,onUpdateField:(n,j)=>l(B,n,j),"is-array-object":!0},null,8,["items","form-data","formSchema","onUpdateField"])]),se(i($,{variant:"text",icon:"pi pi-trash",severity:"danger",size:"small",class:"mt-6",onClick:n=>f.$emit("removeItem",f.item,B)},null,8,["onClick"]),[[g,"删除此项"]])])],2))),128)),i($,{label:"添加一项",icon:"pi pi-plus",size:"small",variant:"outlined",class:"w-fit",onClick:L[0]||(L[0]=A=>f.$emit("addItem",f.item))})]),(w=f.formSchema.errors)!=null&&w[f.item.field]?(t(),h(N,{key:0,severity:"error",size:"small",variant:"simple",class:"mt-1"},{default:y(()=>{var A;return[T(D((A=f.formSchema.errors[f.item.field][0])==null?void 0:A.message),1)]}),_:1})):_("",!0)])}}}),et={key:0,class:"text-gray-500 dark:text-gray-200 text-xs mx-5 mt-3 whitespace-pre-line"},at={class:"pt-4"},lt=ue({__name:"dynamicForm.tmpl",props:{toolName:{},runIsLoading:{type:Boolean}},setup(ae){const X=we(),S=ae,C=V([]),l=V({}),x=V({}),f=V(!1),L=V({}),$=V(""),N=me(()=>C.value.filter(d=>d.type!==M.arrayObject)),g=me(()=>C.value.filter(d=>d.type===M.arrayObject)),w=d=>({multiselect:[],boolean:!1,arrayObject:[]})[d]??"",A=()=>{const d={};C.value.forEach(u=>{var F;let m=(F=x.value)==null?void 0:F[u.field];m==null&&(m=u.default!==void 0?JSON.parse(JSON.stringify(u.default)):w(u.type)),m=B(m,u.type),m=n(m,u),d[u.field]=m}),l.value=d},B=(d,u)=>u===M.date&&d?ee(d).toDate():d,n=(d,u)=>u.type!==M.arrayObject?d:(Array.isArray(d)?d:[]).map(F=>{const z={};return(u.itemSchema||[]).forEach(P=>{let q=(F==null?void 0:F[P.field])??P.default??w(P.type);P.type===M.date&&q&&(q=ee(q).toDate()),z[P.field]=q}),z}),j=async d=>{var m,F;const u=await sa(d);if(u.result===!0){C.value=((m=u.data)==null?void 0:m.components)||[],$.value=((F=u.data)==null?void 0:F.description)||"";const z=await Ve(d);z.result===!0?x.value=z.data||{}:x.value={}}else C.value=[],$.value="";A()};xe(()=>S.toolName,d=>{d&&j(d)},{immediate:!0});const c=d=>{l.value[d.field]||(l.value[d.field]=[]);const u={};(d.itemSchema||[]).forEach(m=>{u[m.field]=m.default??w(m.type)}),l.value[d.field].push(u)},G=(d,u)=>{l.value[d.field]&&l.value[d.field].length>u&&l.value[d.field].splice(u,1)},le=(d,u)=>{l.value[d]=u},ne=(d,u,m,F)=>{const z=l.value[d];Array.isArray(z)&&z[u]&&(z[u][m]=F)},Q=async({values:d})=>{const u={};return C.value.forEach(m=>{if(m.required){const F=l.value[m.field];let z=!0;(F==null||F===""||(m.type===M.multiSelect||m.type===M.arrayObject)&&Array.isArray(F)&&F.length===0)&&(z=!1),z||(u[m.field]=[{message:`${m.label}不能为空`}])}if(m.type===M.arrayObject&&m.itemSchema){const F=l.value[m.field];Array.isArray(F)&&F.forEach((z,P)=>{m.itemSchema.forEach(q=>{if(q.required){const E=z[q.field];let ce=!0;if((E==null||E===""||q.type===M.multiSelect&&Array.isArray(E)&&E.length===0)&&(ce=!1),!ce){const _e=`${m.field}[${P}].${q.field}`;u[_e]={message:`${q.label}不能为空`,type:"required"}}}})})}}),{values:d,errors:u}},oe=async({valid:d})=>{const u=await Q({values:l.value});if(!d||Object.keys(u.errors).length>0){L.value=u.errors;return}L.value={};try{f.value=!0;const m=JSON.parse(JSON.stringify(l.value));C.value.forEach(z=>{z.type===M.date&&m[z.field]&&(m[z.field]=ee(m[z.field]).format("YYYY-MM-DD")),z.type===M.arrayObject&&m[z.field]&&(m[z.field]=m[z.field].map(P=>{const q={...P};return(z.itemSchema||[]).forEach(E=>{E.type===M.date&&q[E.field]&&(q[E.field]=ee(q[E.field]).format("YYYY-MM-DD"))}),q}))}),f.value=!0;const F=await Ue(S.toolName,m);f.value=!1,F.result===!0&&(X.add({severity:"success",summary:"保存成功！",life:3e3}),j(S.toolName))}catch(m){console.error("保存失败:",m)}finally{f.value=!1}};return(d,u)=>{const m=ve,F=Ie,z=Se;return t(),o(R,null,[$.value?(t(),o("div",et,D($.value),1)):_("",!0),i(z,{class:"mx-5 my-5 border-1 border-gray-100 dark:border-neutral-700",pt:{body:{class:"pt-0"}}},{content:y(()=>[u[0]||(u[0]=e("div",{class:"font-semibold py-3"},"配置参数",-1)),u[1]||(u[1]=e("span",{class:"text-xs text-gray-500 dark:text-gray-400"}," 配置参数保存成功后方可运行并获取分析结果 ",-1)),C.value&&C.value.length>0?(t(),h(F,{key:0,onSubmit:oe,class:"mt-3",resolver:Q},{default:y(P=>[i(Me,{items:N.value,"form-data":l.value,formSchema:{...P,errors:L.value},"grid-col":2,onUpdateField:le},null,8,["items","form-data","formSchema"]),(t(!0),o(R,null,te(g.value,q=>(t(),h(Zl,{key:q.field,item:q,"form-data":l.value,formSchema:{...P,errors:L.value},onAddItem:c,onRemoveItem:G,onUpdateArrayField:ne},null,8,["item","form-data","formSchema"]))),128)),e("div",at,[i(m,{label:"保存",type:"submit",size:"small",variant:"outlined",disabled:d.runIsLoading,loading:f.value},null,8,["disabled","loading"])])]),_:1})):_("",!0)]),_:1})],64)}}}),tt={class:"flex items-center justify-between py-3 pl-4 pr-1"},st={class:"space-x-1"},ot={class:"flex-1 overflow-y-auto"},rt={key:0,class:"space-y-1"},it=["onClick"],nt={class:"flex-1 truncate"},dt={key:1,class:"h-full flex flex-col items-center pt-30 gap-4"},ut={key:0,class:"flex-1 min-w-0 h-full flex flex-col relative"},ct={class:"px-4 h-[59px] flex justify-between items-center sticky left-0 top-0"},pt={class:"flex flex-col justify-center gap-1"},mt={class:"font-semibold text-sm"},ft={key:0,class:"text-xs"},vt=["href"],_t={key:1},yt={class:"flex-1 flex flex-col overflow-y-auto overflow-x-hidden"},gt={key:1,class:"flex-1 min-w-0 h-full flex flex-col justify-center items-center gap-4"},Vt=ue({__name:"tool.page",setup(ae){const X=we(),S=V(null),C=V(null),l=V([]),x=V(""),f=V(!1),L=V(!1),$=me(()=>Object.values(pe).includes(x.value)),N={stock:{[Z.tool1]:"https://www.quantclass.cn/online-player/67ea6073439532bed6a910d8",[Z.tool2]:"https://www.quantclass.cn/online-player/67ed0cc0439532bed6a92d3a",[Z.tool3]:"https://www.quantclass.cn/online-player/683983a86f9bf2ccf0e2f4b0",[Z.tool4]:"https://www.quantclass.cn/online-player/683983a86f9bf2ccf0e2f4b0"},coin:{[K.tool2]:"https://www.quantclass.cn/online-player/67d7fa20df1ef61e00afa2c0",[K.tool1]:"https://www.quantclass.cn/online-player/67e22ac007978973f320e23e",[K.tool3]:"https://www.quantclass.cn/online-player/67e22ac007978973f320e23e",[K.tool4]:"https://www.quantclass.cn/online-player/67e22ac007978973f320e23e",[K.tool5]:"https://www.quantclass.cn/online-player/67e22ac007978973f320e23e"},positionCoin:{[pe.tool1]:"https://www.quantclass.cn/online-player/683983a86f9bf2ccf0e2f4b0"}};oa(()=>{g()});const g=async()=>{const j=await ra();j.result===!0&&(l.value=j.data||[],l.value.length>0&&w(l.value[0]))},w=j=>{x.value=j,L.value=!1},A=async j=>{const c=await Ve(j);c.result===!0&&(c.data||(L.value=!0))},B=async()=>{if(await A(x.value),L.value){X.add({severity:"warn",summary:"请先填写配置参数并保存后再点击运行",life:3e3});return}f.value=!0;const j=await ia(x.value);f.value=!1,j.result===!0&&(X.add({severity:"success",summary:"运行成功！",life:3e3}),S.value&&S.value.loadToolAnalysisInfo(x.value))},n=()=>{C.value&&C.value.openDialog()};return(j,c)=>{const G=ve,le=Be,ne=Se,Q=ga,oe=_a,d=fe;return t(),o(R,null,[i(oe,{class:"w-full h-screen overflow-hidden flex"},{default:y(()=>[i(Q,{size:18,class:"min-w-[232px]"},{default:y(()=>[i(ne,{class:"max-h-full border-0 rounded-none shadow-none",pt:{body:{class:"flex-1 p-0 pb-2 min-h-0"},content:{class:"h-full min-h-0 flex flex-col"}}},{header:y(()=>[e("div",tt,[c[0]||(c[0]=e("span",{class:"font-semibold"},"工具库",-1)),e("div",st,[se(i(G,{icon:"pi pi-plus",variant:"outlined",size:"small",severity:"secondary",disabled:v(H)!=="stock",onClick:n},null,8,["disabled"]),[[d,{value:v(H)==="stock"?"导入工具":"导入三方工具功能开发中，敬请期待！"},void 0,{left:!0}]])])])]),content:y(()=>[i(le,{class:"m-0"}),e("div",ot,[l.value.length>0?(t(),o("ul",rt,[(t(!0),o(R,null,te(l.value,u=>(t(),o("li",{onClick:m=>w(u),key:u,class:ie(["h-11 flex justify-between items-center gap-2 font-medium text-sm cursor-pointer pl-4 pr-1 py-2 hover:bg-primary-50 text-gray-700 hover:text-primary-600 dark:bg-neutral-900 dark:hover:bg-primary-900 dark:text-gray-300 dark:hover:text-primary-100",x.value===u?"text-primary-600 bg-primary-50 dark:text-primary-100 dark:bg-primary-900":""])},[se((t(),o("span",nt,[T(D(u),1)])),[[d,u]])],10,it))),128))])):(t(),o("div",dt,c[1]||(c[1]=[e("img",{src:ke,class:"w-30 h-auto"},null,-1),e("div",{class:"space-y-1 flex flex-col items-center"},[e("span",{class:"text-gray-500 text-sm"},"暂无工具")],-1)])))])]),_:1})]),_:1}),i(Q,{size:82},{default:y(()=>[l.value.length>0?(t(),o("div",ut,[e("div",ct,[e("div",pt,[e("span",mt,D(x.value),1),$.value?(t(),o("div",ft,[c[2]||(c[2]=e("span",{class:"text-gray-600 dark:text-gray-200"},"直播链接：",-1)),x.value?(t(),o("a",{key:0,href:N[v(H)][x.value],target:"_blank",class:"text-primary-500 hover:underline"},D(N[v(H)][x.value]),9,vt)):(t(),o("span",_t,"--"))])):_("",!0)]),v(H)==="coin"&&v(K).tool3===x.value?_("",!0):(t(),h(G,{key:0,icon:"pi pi-caret-right",label:"运行",size:"small",onClick:B,class:"ring",loading:f.value},null,8,["loading"]))]),i(le,{class:"m-0"}),e("div",yt,[$.value?(t(),h(zl,{key:0,toolName:x.value,runIsLoading:f.value},null,8,["toolName","runIsLoading"])):(t(),h(lt,{key:1,toolName:x.value,runIsLoading:f.value},null,8,["toolName","runIsLoading"])),i(ql,{ref_key:"refToolOutputTmpl",ref:S,toolName:x.value},null,8,["toolName"])])])):(t(),o("div",gt,c[3]||(c[3]=[e("img",{src:ke,class:"w-30 h-auto"},null,-1),e("span",{class:"text-gray-500 text-sm"},"暂无信息",-1)])))]),_:1})]),_:1}),i(ya,{title:"工具文件",maxFileSize:1*1024*1024,fileType:".py",ref_key:"refUploadConfigDialogTmpl",ref:C,onRefreshConfigInfo:g},null,512)],64)}}});export{Vt as default};
